server {
  
  listen <%= @listen_port %>;
<%# FIXME: code below use hardcoded interface eth0 - either make it to autodetect or use config -%>
<%# FIXME: is there an easier way to get IP of a node? -%>
  server_name munin <%= node[:network][:interfaces][:eth0][:addresses].keys.find {|x| x =~ /^(\d{1,3}\.){3}\d{1,3}$/} -%>;
  access_log <%= File.join(@log_dir, 'nginx_access.log') %>;
  error_log <%= File.join(@log_dir, 'nginx_error.log') %>;

  location /munin {
    root <%= @docroot %>;
  }
  
  location / {
    auth_basic "Munin Server";
    auth_basic_user_file <%= @htpasswd_file %>;
    root <%= @docroot %>;
  }
}
